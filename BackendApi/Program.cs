using BackendApi.Aplicacao.Profiles.DependenciasDoMapper;
using BackendApi.Configuracao;
using BackendApi.Infra.Repositorio.Configuração;
using BackendApi.Modelo;
using MediatR;

var builder = WebApplication.CreateBuilder(args);


string filePath = "C:\\Amauri\\GitHub\\BackendApiConnection2.txt";
builder.Services.ConfigureDbContext(filePath);
builder.Services.VersionamentoApi();
builder.Services.AddControllers();  
builder.Services.AddEndpointsApiExplorer(); //importante para gerar automaticamente a documentação do Swagger com base nos controladores e ações definidos na API.
builder.Services.AddSwaggerGen(); //responsável por gerar a documentação do Swagger 
builder.Services.DependenciasDoEntity();
builder.Services.DependenciasDoMapper();
builder.Services.AddCors(); //permitir um domínio acessem recursos em outro domínio
builder.Services.AddMediatR(AppDomain.CurrentDomain.GetAssemblies()); //são responsáveis por processar comandos e consultas
builder.Services.ConfiguracaoSwaggerGen();
builder.Services.AddCurrentUserService();



var app = builder.Build();

app.ConfiguracaoSwagger();


app.UseMiddleware<ProcessarSolicitacaoRespostaHTTP>(); //criado para lidar com erros e exceções
app.UseHttpsRedirection();
app.UseAuthorization();
app.MapControllers();
app.Run();
